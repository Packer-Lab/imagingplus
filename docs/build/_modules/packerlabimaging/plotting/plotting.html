
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>packerlabimaging.plotting.plotting &#8212; packerlabimaging 0.1-alpha documentation</title>
    <link rel="stylesheet" type="text/css" href="../../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinxdoc.css" />
    <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">packerlabimaging 0.1-alpha documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" accesskey="U">Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">packerlabimaging.plotting.plotting</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for packerlabimaging.plotting.plotting</h1><div class="highlight"><pre>
<span></span><span class="c1"># library of convenience plotting funcs that are used for making various plots for all optical photostimulation/imaging experiments</span>

<span class="c1"># imports</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">packerlabimaging</span> <span class="kn">import</span> <span class="n">Experiment</span>

<span class="kn">from</span> <span class="nn">packerlabimaging.AllOpticalMain</span> <span class="kn">import</span> <span class="n">AllOpticalTrial</span>

<span class="kn">from</span> <span class="nn">packerlabimaging.TwoPhotonImagingMain</span> <span class="kn">import</span> <span class="n">TwoPhotonImagingTrial</span>
<span class="kn">from</span> <span class="nn">packerlabimaging.plotting._utils</span> <span class="kn">import</span> <span class="n">plotting_decorator</span><span class="p">,</span> <span class="n">make_random_color_array</span><span class="p">,</span> <span class="n">_add_scalebar</span><span class="p">,</span> \
    <span class="n">image_frame_options</span><span class="p">,</span> <span class="n">dataplot_frame_options</span><span class="p">,</span> <span class="n">dataplot_ax_options</span><span class="p">,</span> <span class="n">plot_coordinates</span><span class="p">,</span> <span class="n">heatmap_options</span><span class="p">,</span> <span class="n">image_frame_ops</span>
<span class="kn">from</span> <span class="nn">packerlabimaging.utils.classes</span> <span class="kn">import</span> <span class="n">ObjectClassError</span>


<span class="c1"># DATA ANALYSIS PLOTTING FUNCS</span>

<span class="c1"># suite2p data</span>
<span class="c1"># simple plot of the location of the given cell(s) against a black FOV</span>
<div class="viewcode-block" id="plotRoiLocations"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plotRoiLocations">[docs]</a><span class="nd">@mpl</span><span class="o">.</span><span class="n">rc_context</span><span class="p">(</span><span class="n">image_frame_ops</span><span class="p">)</span>
<span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plotRoiLocations</span><span class="p">(</span><span class="n">trialobj</span><span class="p">:</span> <span class="n">TwoPhotonImagingTrial</span><span class="p">,</span> <span class="n">suite2p_rois</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                     <span class="n">background</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plots an image of the FOV to show the locations of cells given in cells ls.</span>

<span class="sd">    :param trialobj: alloptical or 2p imaging object</span>
<span class="sd">    :param background: either 2dim numpy array to use as the backsplash or None (default; which is a black background)</span>
<span class="sd">    :param suite2p_rois: list of ROIs (suite2p cell IDs) to show coord location, default is &#39;all&#39; (which is all ROIs)</span>
<span class="sd">    :param edgecolor: specify edgecolor of the scatter plot for cells</span>
<span class="sd">    :param facecolor: specify facecolor of the scatter plot for cells</span>
<span class="sd">    :param cells: list of cells to plot</span>
<span class="sd">    :param title: title for plot</span>
<span class="sd">    :param color_float_list: if given, it will be used to color the cells according a colormap</span>
<span class="sd">    :param cmap: cmap to be used in conjuction with the color_float_array argument</span>
<span class="sd">    :param show_s2p_targets: if True, then will prioritize coloring of cell points based on whether they were photostim targets</span>
<span class="sd">    :param invert_y: if True, invert the reverse the direction of the y axis</span>
<span class="sd">    :param fig: a matplotlib.Figure instance, if provided use this fig for plotting</span>
<span class="sd">    :param ax: a matplotlib.Axes.axes instance, if provided use this ax for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, ax: returns fig and ax object, if show is False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># image_frame_options()</span>

    <span class="c1"># fig = kwargs[&#39;fig&#39;]</span>
    <span class="c1"># suptitle = kwargs[&#39;suptitle&#39;] if &#39;suptitle&#39; in [*kwargs] else None</span>
    <span class="n">image_frame_options</span><span class="p">()</span> <span class="k">if</span> <span class="s1">&#39;apply_image_frame_options&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">kwargs</span><span class="p">]</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span>
        <span class="s1">&#39;apply_image_frame_options&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="kc">None</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>

    <span class="n">facecolors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;facecolors&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;facecolors&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">kwargs</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;none&#39;</span>
    <span class="n">edgecolors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;edgecolors&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;edgecolors&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">kwargs</span><span class="p">]</span> <span class="k">else</span> <span class="s1">&#39;orange&#39;</span>

    <span class="k">if</span> <span class="n">suite2p_rois</span> <span class="o">==</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="n">suite2p_rois</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">cell_id</span>

    <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">suite2p_rois</span><span class="p">:</span>
        <span class="n">y</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">stat</span><span class="p">[</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">cell_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cell</span><span class="p">)][</span><span class="s1">&#39;med&#39;</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="n">facecolors</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">background</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">black</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_x</span><span class="p">,</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_y</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">black</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_x</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;Greys_r&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">invert_yaxis</span><span class="p">()</span>

    <span class="n">_add_scalebar</span><span class="p">(</span><span class="n">trialobj</span><span class="o">=</span><span class="n">trialobj</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span> <span class="k">if</span> <span class="s1">&#39;scalebar&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">kwargs</span><span class="p">]</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scalebar&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span></div>


<div class="viewcode-block" id="makeSuite2pPlots"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.makeSuite2pPlots">[docs]</a><span class="nd">@mpl</span><span class="o">.</span><span class="n">rc_context</span><span class="p">(</span><span class="n">image_frame_ops</span><span class="p">)</span>
<span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">makeSuite2pPlots</span><span class="p">(</span><span class="n">obj</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Experiment</span><span class="p">,</span> <span class="n">TwoPhotonImagingTrial</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Makes four plots that are created by Suite2p output.</span>

<span class="sd">    credit: run_s2p tutorial on Mouseland/Suite2p on github</span>

<span class="sd">    :param obj: Experiment or Trial object to use for creating Suite2p plots.</span>
<span class="sd">    :param axs: a matplotlib.Axes.axes instance (4 cols x 1 rows), if provided use these axes for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, axs: returns fig and ax object, if show is False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">heatmap_options</span><span class="p">()</span>

    <span class="n">axs</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;axs&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;axs&#39;</span><span class="p">)</span>

    <span class="c1"># f, axs = plt.subplots(figsize=[15, 5], nrows=1, ncols=4)</span>

    <span class="c1"># plt.subplot(1, 4, 1)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">output_op</span><span class="p">[</span><span class="s1">&#39;max_proj&#39;</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Registered Image, Max Projection&quot;</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># plt.subplot(1, 4, 2)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">im</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;All ROIs Found&quot;</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># plt.subplot(1, 4, 3)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">im</span><span class="p">[</span><span class="o">~</span><span class="n">obj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">iscell</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;All Non-Cell ROIs&quot;</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># plt.subplot(1, 4, 4)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">im</span><span class="p">[</span><span class="n">obj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">iscell</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;All Cell ROIs&quot;</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">_add_scalebar</span><span class="p">(</span><span class="n">trialobj</span><span class="o">=</span><span class="n">obj</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span> <span class="k">if</span> <span class="s1">&#39;scalebar&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">kwargs</span><span class="p">]</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scalebar&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">True</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span></div>


<div class="viewcode-block" id="plot_flu_trace"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plot_flu_trace">[docs]</a><span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot_flu_trace</span><span class="p">(</span><span class="n">trialobj</span><span class="p">:</span> <span class="n">TwoPhotonImagingTrial</span><span class="p">,</span> <span class="n">cell</span><span class="p">,</span> <span class="n">to_plot</span><span class="o">=</span><span class="s1">&#39;raw&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot individual cell&#39;s flu or dFF trace, with photostim. timings for that cell</span>

<span class="sd">    :param trialobj: trialobject to plot</span>
<span class="sd">    :param cell:</span>
<span class="sd">    :param to_plot:</span>
<span class="sd">    :param fig: a matplotlib.Figure instance, if provided use this fig for plotting</span>
<span class="sd">    :param ax: a matplotlib.Axes.axes instance, if provided use this ax for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, ax: returns fig and ax object, if show is False</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">dataplot_frame_options</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
            <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="n">idx</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Suite2p</span><span class="o">.</span><span class="n">cell_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cell</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">to_plot</span> <span class="o">==</span> <span class="s1">&#39;raw&#39;</span><span class="p">:</span>
        <span class="n">data_to_plot</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">to_plot</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">trialobj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">layers</span><span class="p">]:</span>
            <span class="n">data_to_plot</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="n">to_plot</span><span class="p">][</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;to_plot processed data is not found in trialobj.data.layers. &quot;</span><span class="p">)</span>

    <span class="c1"># make the plot either as just the raw trace or as a dFF trace with the std threshold line drawn as well.</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_to_plot</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

    <span class="n">dataplot_ax_options</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">data_length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data_to_plot</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="n">mpl</span><span class="o">.</span><span class="n">pyplot</span><span class="o">.</span><span class="n">rcdefaults</span><span class="p">()</span></div>


<span class="c1"># plots the raw trace for the Flu mean of the FOV (similar to the ZProject in Fiji)</span>
<div class="viewcode-block" id="plotMeanFovFluTrace"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plotMeanFovFluTrace">[docs]</a><span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plotMeanFovFluTrace</span><span class="p">(</span><span class="n">trialobj</span><span class="p">:</span> <span class="n">TwoPhotonImagingTrial</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;make plot of mean Ca trace averaged over the whole FOV</span>

<span class="sd">    :param fig: a matplotlib.Figure instance, if provided use this fig for plotting</span>
<span class="sd">    :param ax: a matplotlib.Axes.axes instance, if provided use this ax for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, ax: returns fig and ax object, if show is False</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trialobj</span><span class="p">,</span> <span class="s1">&#39;meanFovFluTrace&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;Cannot make plot. Missing meanFovFluTrace attribute.&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">dataplot_frame_options</span><span class="p">()</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
        <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;lw&#39;</span><span class="p">,</span> <span class="s1">&#39;linewidth&#39;</span><span class="p">]:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="n">lw</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="n">data_to_plot</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">meanFovFluTrace</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> \- PLOTTING mean raw flu trace ... &quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">data_to_plot</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;forestgreen&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;frame #s&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Flu (a.u.)&#39;</span><span class="p">)</span>

        <span class="n">dataplot_ax_options</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">data_length</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">data_to_plot</span><span class="p">),</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_photostim_traces_overlap"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plot_photostim_traces_overlap">[docs]</a><span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot_photostim_traces_overlap</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">trialobj</span><span class="p">:</span> <span class="n">AllOpticalTrial</span><span class="p">,</span> <span class="n">exclude_id</span><span class="o">=</span><span class="p">[],</span> <span class="n">y_spacing_factor</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                                  <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;Time (seconds)&#39;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param array:</span>
<span class="sd">    :param trialobj:</span>
<span class="sd">    :param spacing: a multiplication factor that will be used when setting the spacing between each trace in the final plot</span>
<span class="sd">    :param title:</span>
<span class="sd">    :param y_min:</span>
<span class="sd">    :param y_max:</span>
<span class="sd">    :param x_label:</span>
<span class="sd">    :param save_fig:</span>
<span class="sd">    :param fig: a matplotlib.Figure instance, if provided use this fig for plotting</span>
<span class="sd">    :param ax: a matplotlib.Axes.axes instance, if provided use this ax for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, ax: returns fig and ax object, if show is False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">dataplot_frame_options</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len_</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">i</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude_id</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;linewidth&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">linewidth</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">linewidth</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">y_spacing_factor</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">linewidth</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">stim_start_frames</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">n_frames</span> <span class="o">-</span> <span class="mi">3000</span><span class="p">])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># change x axis ticks to seconds</span>
    <span class="k">if</span> <span class="s1">&#39;Time&#39;</span> <span class="ow">in</span> <span class="n">x_axis</span> <span class="ow">or</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">x_axis</span><span class="p">:</span>
        <span class="c1"># change x axis ticks to every 30 seconds</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">n_frames</span> <span class="o">//</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">fps</span><span class="p">),</span> <span class="mi">30</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[(</span><span class="n">label</span> <span class="o">*</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">fps</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (secs)&#39;</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_axis</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;y_lim&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_lim&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">y_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">len_</span> <span class="o">*</span> <span class="mi">40</span> <span class="o">*</span> <span class="n">y_spacing_factor</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">y_max</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">((</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39; - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">len_</span> <span class="o">+</span> <span class="s1">&#39; cells&#39;</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">dataplot_ax_options</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">data_length</span><span class="o">=</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="plot_s2p_raw"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plot_s2p_raw">[docs]</a><span class="k">def</span> <span class="nf">plot_s2p_raw</span><span class="p">(</span><span class="n">trialobj</span><span class="p">,</span> <span class="n">cell_id</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param trialobj:</span>
<span class="sd">    :param cell_id:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">baseline_raw</span><span class="p">[</span><span class="n">trialobj</span><span class="o">.</span><span class="n">cell_id</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">baseline_raw</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1"># suite2p data</span>


<span class="c1"># LFP</span>
<div class="viewcode-block" id="plotLfpSignal"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plotLfpSignal">[docs]</a><span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plotLfpSignal</span><span class="p">(</span><span class="n">trialobj</span><span class="p">:</span> <span class="n">TwoPhotonImagingTrial</span><span class="p">,</span> <span class="n">stim_span_color</span><span class="o">=</span><span class="s1">&#39;powderblue&#39;</span><span class="p">,</span> <span class="n">downsample</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                  <span class="n">stim_lines</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">sz_markings</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                  <span class="n">title</span><span class="o">=</span><span class="s1">&#39;LFP trace&#39;</span><span class="p">,</span> <span class="n">x_axis</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">hide_xlabel</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;make plot of LFP with also showing stim locations</span>
<span class="sd">    NOTE: ONLY PLOTTING LFP SIGNAL CROPPED TO 2P IMAGING FRAME START AND END TIMES - SO CUTTING OUT THE LFP SIGNAL BEFORE AND AFTER</span>

<span class="sd">    :param trialobj:</span>
<span class="sd">    :param stim_span_color:</span>
<span class="sd">    :param downsample:</span>
<span class="sd">    :param stim_lines:</span>
<span class="sd">    :param sz_markings:</span>
<span class="sd">    :param title:</span>
<span class="sd">    :param x_axis:</span>
<span class="sd">    :param hide_xlabel:</span>
<span class="sd">    :param fig: a matplotlib.Figure instance, if provided use this fig for plotting</span>
<span class="sd">    :param ax: a matplotlib.Axes.axes instance, if provided use this ax for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, ax: returns fig and ax object, if show is False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2"> \- PLOTTING LFP Signal trace ... &quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="p">,</span> <span class="s1">&#39;voltage&#39;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;no voltage data found in .Paq submodule. Please add to .Paq file&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># plot LFP signal</span>
    <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">color</span> <span class="o">=</span> <span class="s1">&#39;steelblue&#39;</span>

    <span class="c1"># option for downsampling of data plot trace</span>
    <span class="n">x</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">voltage</span><span class="p">[</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">frame_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">frame_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]))</span>
    <span class="n">signal</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">voltage</span><span class="p">[</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">frame_times</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">frame_times</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
    <span class="k">if</span> <span class="n">downsample</span><span class="p">:</span>
        <span class="n">labels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">)</span> <span class="o">/</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">paq_rate</span> <span class="o">*</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">15</span><span class="p">))[::</span><span class="mi">2</span><span class="p">]</span>  <span class="c1"># set x ticks at every 30 secs</span>
        <span class="n">down</span> <span class="o">=</span> <span class="mi">1000</span>
        <span class="n">signal</span> <span class="o">=</span> <span class="n">signal</span><span class="p">[::</span><span class="n">down</span><span class="p">]</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[::</span><span class="n">down</span><span class="p">]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">signal</span><span class="p">),</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;something went wrong with the downsampling&#39;</span><span class="p">)</span>

    <span class="c1"># change linewidth</span>
    <span class="k">if</span> <span class="s1">&#39;linewidth&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;linewidth&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lw</span> <span class="o">=</span> <span class="mf">0.4</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">signal</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>  <span class="c1">## NOTE: ONLY PLOTTING LFP SIGNAL RELATED TO</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mf">0.02</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_visible</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
    <span class="c1"># ax.spines[&#39;left&#39;].set_visible(False)</span>

    <span class="c1"># change x axis ticks to seconds</span>
    <span class="n">labels_</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;labels&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="s1">&#39;labels&#39;</span> <span class="ow">in</span> <span class="p">[</span><span class="o">*</span><span class="n">kwargs</span><span class="p">]</span> <span class="k">else</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span>
    <span class="n">labels_</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">labels_</span><span class="p">]</span>
    <span class="k">if</span> <span class="s1">&#39;time&#39;</span> <span class="ow">in</span> <span class="n">x_axis</span> <span class="ow">or</span> <span class="s1">&#39;Time&#39;</span> <span class="ow">in</span> <span class="n">x_axis</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">ticks</span><span class="o">=</span><span class="p">[(</span><span class="n">label</span> <span class="o">*</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">paq_rate</span><span class="p">)</span> <span class="k">for</span> <span class="n">label</span> <span class="ow">in</span> <span class="n">labels_</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">labels_</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">hide_xlabel</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time (secs)&#39;</span><span class="p">)</span>
    <span class="c1"># elif &#39;frame&#39; or &quot;frames&quot; or &quot;Frames&quot; or &quot;Frame&quot; in x_axis:</span>
    <span class="c1">#     x_ticks = range(0, trialobj.n_frames, 2000)</span>
    <span class="c1">#     x_clocks = [x_fr*trialobj.paq_rate for x_fr in x_ticks]  ## convert to Paq clock dimension</span>
    <span class="c1">#     ax.set_xticks(x_clocks)</span>
    <span class="c1">#     ax.set_xticklabels(x_ticks)</span>
    <span class="c1">#     if not hide_xlabel:</span>
    <span class="c1">#         ax.set_xlabel(&#39;Frames&#39;)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Paq clock&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Voltage&#39;</span><span class="p">)</span>
    <span class="c1"># ax.set_xlim([trialobj.imparams.frame_start_time_actual, trialobj.imparams.frame_end_time_actual])  ## this should be limited to the 2p acquisition duration only</span>

    <span class="c1"># set ylimits:</span>
    <span class="k">if</span> <span class="s1">&#39;ylims&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylims&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">voltage</span><span class="p">)</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Paq</span><span class="o">.</span><span class="n">voltage</span><span class="p">)</span> <span class="o">+</span> <span class="mi">10</span><span class="p">])</span>

    <span class="c1"># set xlimits:</span>
    <span class="k">if</span> <span class="s1">&#39;xlims&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">and</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlims&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlims&#39;</span><span class="p">])</span>

    <span class="c1"># add title</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">trialobj</span><span class="o">.</span><span class="n">t_series_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

    <span class="c1"># return None</span>
    <span class="c1"># if not &#39;fig&#39; in kwargs.keys():</span>
    <span class="c1">#     ax.set_title(</span>
    <span class="c1">#         &#39;%s - %s %s %s&#39; % (title, trialobj.metainfo[&#39;exptype&#39;], trialobj.metainfo[&#39;exp_id&#39;], trialobj.metainfo[&#39;trial_id&#39;]))</span>
    <span class="c1">#</span>
    <span class="c1"># # options for showing plot or returning plot</span>
    <span class="c1"># if &#39;show&#39; in kwargs.keys():</span>
    <span class="c1">#     plt.show() if kwargs[&#39;show&#39;] else None</span>
    <span class="c1"># else:</span>
    <span class="c1">#     plt.show()</span>

    <span class="c1"># return fig, ax if &#39;fig&#39; in kwargs.keys() else None</span>


<span class="c1"># LFP</span>


<span class="c1">### plot entire trace of individual targeted cells as super clean subplots, with the same y-axis lims</span>
<div class="viewcode-block" id="plot_photostim_traces"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plot_photostim_traces">[docs]</a><span class="k">def</span> <span class="nf">plot_photostim_traces</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">trialobj</span><span class="p">:</span> <span class="n">AllOpticalTrial</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">y_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">y_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">save_fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    :param array:</span>
<span class="sd">    :param trialobj:</span>
<span class="sd">    :param title:</span>
<span class="sd">    :param y_min:</span>
<span class="sd">    :param y_max:</span>
<span class="sd">    :param x_label:</span>
<span class="sd">    :param y_label:</span>
<span class="sd">    :param save_fig:</span>
<span class="sd">    :param kwargs:</span>
<span class="sd">        options include:</span>
<span class="sd">            hits: ls; a ls of 1s and 0s that is used to add a scatter point to the plot at stim_start_frames indexes at 1s</span>
<span class="sd">    :return:</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make rolling average for these plots</span>
    <span class="n">w</span> <span class="o">=</span> <span class="mi">30</span>
    <span class="n">array</span> <span class="o">=</span> <span class="p">[(</span><span class="n">np</span><span class="o">.</span><span class="n">convolve</span><span class="p">(</span><span class="n">trace</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">w</span><span class="p">),</span> <span class="s1">&#39;valid&#39;</span><span class="p">)</span> <span class="o">/</span> <span class="n">w</span><span class="p">)</span> <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">array</span><span class="p">]</span>

    <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nrows</span><span class="o">=</span><span class="n">len_</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">len_</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">axs</span><span class="p">)):</span>
        <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">y_min</span> <span class="o">!=</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">y_min</span><span class="p">,</span> <span class="n">y_max</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">stim_start_frames</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">j</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">if</span> <span class="s1">&#39;scatter&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">stim_start_frames</span><span class="p">[</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;scatter&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;chocolate&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">len_</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">s2p_cell_targets</span><span class="p">):</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Cell # </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">s2p_cell_targets</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">if</span> <span class="s1">&#39;line_ids&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">axs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Target </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;line_ids&#39;</span><span class="p">][</span><span class="n">i</span><span class="p">]],</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">((</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39; - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">len_</span> <span class="o">+</span> <span class="s1">&#39; cells&#39;</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">save_fig</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">save_fig</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span></div>


<span class="c1">### photostim analysis - PLOT avg over photostim. trials traces for the provided traces</span>
<span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot_periphotostim_avg2</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">fps</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend_labels</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">colors</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">avg_with_std</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="s1">&#39;high quality plot&#39;</span><span class="p">,</span> <span class="n">pre_stim_sec</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># if &#39;fig&#39; in kwargs.keys():</span>
    <span class="c1">#     fig = kwargs[&#39;fig&#39;]</span>
    <span class="c1">#     ax = kwargs[&#39;ax&#39;]</span>
    <span class="c1"># else:</span>
    <span class="c1">#     if &#39;figsize&#39; in kwargs.keys():</span>
    <span class="c1">#         fig, ax = plt.subplots(figsize=kwargs[&#39;figsize&#39;])</span>
    <span class="c1">#     else:</span>
    <span class="c1">#         fig, ax = plt.subplots(figsize=[5, 4])</span>

    <span class="n">meantraces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">stdtraces</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">legend_labels</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">),</span> <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;please provide same number of legend labels as dataset&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">colors</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">make_random_color_array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">colors</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">legend_labels</span><span class="p">)</span>
        <span class="n">avg_only</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- plotting average +/- std fill for each dataset&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)):</span>
            <span class="n">meanst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">meantraces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meanst</span><span class="p">)</span>
            <span class="n">stdtraces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">meanst</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">meantraces</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;|--- length mismatch in mean traces of datasets... </span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, shape0 </span><span class="si">{</span><span class="n">meanst</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and shape1 </span><span class="si">{</span><span class="n">meantraces</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">std</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">stdtraces</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;|--- length mismatch in std traces of datasets...</span><span class="si">{</span><span class="n">title</span><span class="si">}</span><span class="s2">, shape0 </span><span class="si">{</span><span class="n">std</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2"> and shape1 </span><span class="si">{</span><span class="n">stdtraces</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">dataset</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">dataset</span><span class="p">)</span>
        <span class="n">meanst</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ddof</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">meantraces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meanst</span><span class="p">)</span>
        <span class="n">stdtraces</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">std</span><span class="p">)</span>
        <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;black&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;please provide the data to plot in a ls format, each different data group as a ls item...&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span> <span class="ow">or</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="s1">&#39;frames&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;Frames&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span>
        <span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
        <span class="c1">## change xaxis to time (secs)</span>
        <span class="k">if</span> <span class="n">fps</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">pre_stim_sec</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">meantraces</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">/</span> <span class="n">fps</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span>
                    <span class="n">meantraces</span><span class="p">[</span>
                        <span class="mi">0</span><span class="p">]))</span> <span class="o">-</span> <span class="n">pre_stim_sec</span>  <span class="c1"># x scale, but in time domain (transformed from frames based on the provided fps)</span>
                <span class="k">if</span> <span class="s1">&#39;xlabel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time post stim (secs)&#39;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;need to provide a pre_stim_sec value to the function call!&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="ne">AttributeError</span><span class="p">(</span><span class="s1">&#39;need to provide fps value to convert xaxis in units of time (secs)&#39;</span><span class="p">)</span>
    <span class="k">elif</span> <span class="s1">&#39;frames&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]</span> <span class="ow">or</span> <span class="s1">&#39;Frames&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;xlabel&#39;</span><span class="p">]:</span>
        <span class="n">x_range</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meanst</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Frames&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">meantraces</span><span class="p">)):</span>
        <span class="k">if</span> <span class="n">avg_with_std</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_range</span><span class="p">):</span>  <span class="c1">## TEMP FIX</span>
                <span class="n">mismatch</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x_range</span><span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
                <span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">mismatch</span><span class="p">)</span>
                <span class="n">stdtraces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stdtraces</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">mismatch</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s1">&#39;|------ adding </span><span class="si">{</span><span class="n">mismatch</span><span class="si">}</span><span class="s1"> zeros to mean and std-fill traces to make the arrays the same length, new length of plot array: </span><span class="si">{</span><span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> &#39;</span><span class="p">)</span>

            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">stdtraces</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">stdtraces</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.15</span><span class="p">,</span>
                            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">meantraces</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">trace</span> <span class="ow">in</span> <span class="n">dataset</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">trace</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">legend_labels</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;fontsize&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;fontsize&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fontsize</span> <span class="o">=</span> <span class="s1">&#39;medium&#39;</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">legend_labels</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">fontsize</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ylim</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="n">ylim</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylim</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="k">if</span> <span class="s1">&#39;ylabel&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ylabel&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">if</span> <span class="s1">&#39;savepath&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;savepath&#39;</span><span class="p">])</span>

    <span class="c1"># # finalize plot, set title, and show or return axes</span>
    <span class="c1"># ax.set_title(title)</span>
    <span class="c1"># if &#39;show&#39; in kwargs.keys():</span>
    <span class="c1">#     fig.show() if kwargs[&#39;show&#39;] else None</span>
    <span class="c1"># else:</span>
    <span class="c1">#     fig.show()</span>
    <span class="c1">#</span>
    <span class="c1"># if &#39;fig&#39; in kwargs.keys():</span>
    <span class="c1">#     return fig, ax</span>


<span class="c1">### photostim analysis - PLOT avg over all photstim. trials traces from PHOTOSTIM TARGETTED cells</span>
<div class="viewcode-block" id="plot_periphotostim_avg"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plot_periphotostim_avg">[docs]</a><span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot_periphotostim_avg</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">trialobj</span><span class="p">:</span> <span class="n">AllOpticalTrial</span><span class="p">,</span> <span class="n">pre_stim_sec</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">post_stim_sec</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span>
                           <span class="n">avg_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">x_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">y_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot trace across all stims</span>
<span class="sd">    :param arr: Flu traces to plot (will be plotted as individual traces unless avg_only is True) dimensions should be cells x stims x frames</span>
<span class="sd">    :param trialobj: instance object of AllOpticalTrial</span>
<span class="sd">    :param pre_stim_sec: seconds of array to plot for pre-stim period</span>
<span class="sd">    :param post_stim_sec: seconds of array to plot for post-stim period</span>
<span class="sd">    :param title: title to use for plot</span>
<span class="sd">    :param avg_only: if True, only plot the mean trace calculated from the traces provided in arr</span>
<span class="sd">    :param x_label: x axis label</span>
<span class="sd">    :param y_label: y axis label</span>
<span class="sd">    :param kwargs:</span>
<span class="sd">        options include:</span>
<span class="sd">            &#39;stim_duration&#39;: photostimulation duration in secs</span>
<span class="sd">            &#39;y_lims&#39;: tuple, y min and max of the plot</span>
<span class="sd">            &#39;edgecolor&#39;: str, edgecolor of the individual traces behind the mean trace</span>
<span class="sd">            &#39;savepath&#39;: str, path to save plot to</span>

<span class="sd">    :param fig: a matplotlib.Figure instance, if provided use this fig for plotting</span>
<span class="sd">    :param ax: a matplotlib.Axes.axes instance, if provided use this ax for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, ax: returns fig and ax object, if show is False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fps</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">fps</span>  <span class="c1"># frames per second rate of the imaging data collection for the data to be plotted</span>
    <span class="n">exp_prestim</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">pre_stim_frames</span>  <span class="c1"># frames of pre-stim data collected for each trace for this trialobj (should be same as what&#39;s under trialobj.pre_stim_sec)</span>
    <span class="k">if</span> <span class="s1">&#39;stim_duration&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">stim_duration</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;stim_duration&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">stim_duration</span> <span class="o">=</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Targets</span><span class="o">.</span><span class="n">stim_dur</span> <span class="o">/</span> <span class="mi">1000</span>  <span class="c1"># seconds of stimulation duration</span>

    <span class="n">dataplot_frame_options</span><span class="p">()</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>

    <span class="n">x</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>
    <span class="c1"># x range in time (secs)</span>
    <span class="n">x_time</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">fps</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span>
        <span class="mi">1</span><span class="p">])</span> <span class="o">-</span> <span class="n">pre_stim_sec</span>  <span class="c1"># x scale, but in time domain (transformed from frames based on the provided fps)</span>

    <span class="n">len_</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
    <span class="n">flu_avg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># ax.margins(x=0.07)</span>

    <span class="k">if</span> <span class="s1">&#39;alpha&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.2</span>

    <span class="k">if</span> <span class="n">x_label</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s1">&#39;Frames&#39;</span> <span class="ow">in</span> <span class="n">x_label</span> <span class="ow">or</span> <span class="s1">&#39;frames&#39;</span> <span class="ow">in</span> <span class="n">x_label</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x_time</span>  <span class="c1"># set the x plotting range</span>
        <span class="k">if</span> <span class="n">x_label</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="n">x_label</span> <span class="o">+</span> <span class="s1">&#39;post-stimulation relative&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">x_label</span> <span class="o">=</span> <span class="s1">&#39;Time (secs post-stimulation)&#39;</span>

        <span class="k">if</span> <span class="n">avg_only</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># ax.axvspan(exp_prestim/fps, (exp_prestim + stim_duration + 1) / fps, alpha=alpha, color=&#39;plum&#39;, zorder = 3)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fps</span><span class="p">,</span> <span class="mi">0</span> <span class="o">+</span> <span class="n">stim_duration</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fps</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;plum&#39;</span><span class="p">,</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># note that we are setting 0 as the stimulation time</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fps</span><span class="p">,</span> <span class="mi">0</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fps</span> <span class="o">+</span> <span class="n">stim_duration</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;plum&#39;</span><span class="p">,</span>
                       <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># note that we are setting 0 as the stimulation time</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">exp_prestim</span><span class="p">,</span> <span class="n">exp_prestim</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">stim_duration</span> <span class="o">*</span> <span class="n">fps</span><span class="p">),</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;tomato&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">avg_only</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">cell_trace</span> <span class="ow">in</span> <span class="n">arr</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;color&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cell_trace</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;color&#39;</span><span class="p">],</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">cell_trace</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">flu_avg</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mf">2.3</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># plot average trace</span>

    <span class="k">if</span> <span class="s1">&#39;y_lims&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;y_lims&#39;</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">pre_stim_sec</span> <span class="ow">and</span> <span class="n">post_stim_sec</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x_label</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="ow">not</span> <span class="s1">&#39;Frames&#39;</span> <span class="ow">in</span> <span class="n">x_label</span> <span class="ow">or</span> <span class="s1">&#39;frames&#39;</span> <span class="ow">in</span> <span class="n">x_label</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">pre_stim_sec</span><span class="p">,</span>
                        <span class="n">stim_duration</span> <span class="o">+</span> <span class="n">post_stim_sec</span><span class="p">)</span>  <span class="c1"># remember that x axis is set to be relative to the stim time (i.e. stim is at t = 0)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">exp_prestim</span> <span class="o">-</span> <span class="nb">int</span><span class="p">(</span><span class="n">pre_stim_sec</span> <span class="o">*</span> <span class="n">fps</span><span class="p">),</span>
                        <span class="n">exp_prestim</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">stim_duration</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span> <span class="o">+</span> <span class="nb">int</span><span class="p">(</span><span class="n">post_stim_sec</span> <span class="o">*</span> <span class="n">fps</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># set axis labels</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">x_label</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">y_label</span><span class="p">)</span>

    <span class="k">if</span> <span class="s1">&#39;savepath&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;savepath&#39;</span><span class="p">])</span>

    <span class="k">if</span> <span class="n">title</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">((</span><span class="n">title</span> <span class="o">+</span> <span class="s1">&#39; - </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">len_</span> <span class="o">+</span> <span class="s1">&#39; traces&#39;</span><span class="p">),</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span>
                     <span class="n">pad</span><span class="o">=</span><span class="n">pad</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">wrap</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">dataplot_ax_options</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span> <span class="n">data_length</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<span class="c1"># alloptical trial</span>
<span class="c1">### plot the location of all SLM targets, along with option for plotting the mean img of the current trial</span>

<div class="viewcode-block" id="plot_SLMtargets_Locs"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plot_SLMtargets_Locs">[docs]</a><span class="nd">@mpl</span><span class="o">.</span><span class="n">rc_context</span><span class="p">(</span><span class="n">image_frame_ops</span><span class="p">)</span>
<span class="nd">@plotting_decorator</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="k">def</span> <span class="nf">plot_SLMtargets_Locs</span><span class="p">(</span><span class="n">trialobj</span><span class="p">:</span> <span class="n">AllOpticalTrial</span><span class="p">,</span> <span class="n">targets_coords</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">list</span><span class="p">,</span> <span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;all&#39;</span><span class="p">,</span>
                         <span class="n">background</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    plot SLM target coordinate locations</span>

<span class="sd">    :param trialobj:</span>
<span class="sd">    :param targets_coords: ls containing (x,y) coordinates of targets to plot</span>
<span class="sd">    :param background:</span>
<span class="sd">    :param kwargs:</span>
<span class="sd">    :param fig: a matplotlib.Figure instance, if provided use this fig for plotting</span>
<span class="sd">    :param ax: a matplotlib.Axes.axes instance, if provided use this ax for plotting</span>
<span class="sd">    :param show: if False, do not display plot (used when the necessity is to return the fig and ax objects to futher manipulation)</span>
<span class="sd">    :returns fig, ax: returns fig and ax object, if show is False</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">type</span><span class="p">(</span><span class="n">trialobj</span><span class="p">)</span> <span class="o">==</span> <span class="n">AllOpticalTrial</span><span class="p">:</span>
        <span class="k">raise</span> <span class="n">ObjectClassError</span><span class="p">(</span><span class="n">function</span><span class="o">=</span><span class="s1">&#39;plot_SLMtargets_Locs&#39;</span><span class="p">,</span> <span class="n">valid_class</span><span class="o">=</span><span class="p">[</span><span class="n">AllOpticalTrial</span><span class="p">],</span>
                               <span class="n">invalid_class</span><span class="o">=</span><span class="nb">type</span><span class="p">(</span><span class="n">trialobj</span><span class="p">))</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;ax&#39;</span><span class="p">]</span>
    <span class="n">kwargs</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;ax&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">background</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">background</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_x</span><span class="p">,</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_y</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="s1">&#39;uint16&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">)</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="n">make_random_color_array</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Targets</span><span class="o">.</span><span class="n">target_coords</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">targets_coords</span> <span class="ow">is</span> <span class="s1">&#39;all&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Targets</span><span class="o">.</span><span class="n">target_coords</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Targets</span><span class="o">.</span><span class="n">target_coords</span><span class="p">)):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Targets</span><span class="o">.</span><span class="n">target_coords</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">trialobj</span><span class="o">.</span><span class="n">Targets</span><span class="o">.</span><span class="n">target_coords</span><span class="p">[</span><span class="n">i</span><span class="p">][:,</span> <span class="mi">1</span><span class="p">],</span>
                           <span class="n">edgecolors</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;SLM Group </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
                <span class="c1"># for (x, y) in trialobj.Targets.target_coords[i]:</span>
                <span class="c1">#     ax.scatter(x=x, y=y, edgecolors=colors[i], facecolors=&#39;none&#39;, linewidths=2.0)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="s1">&#39;edgecolors&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">edgecolors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;edgecolors&#39;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">edgecolors</span> <span class="o">=</span> <span class="s1">&#39;yellowgreen&#39;</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="n">trialobj</span><span class="o">.</span><span class="n">Targets</span><span class="o">.</span><span class="n">target_coords_all</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span> <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">,</span> <span class="n">facecolors</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">2.0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">targets_coords</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;edgecolors&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">edgecolors</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;edgecolors&#39;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">edgecolors</span> <span class="o">=</span> <span class="s1">&#39;yellowgreen&#39;</span>
        <span class="n">plot_coordinates</span><span class="p">(</span><span class="n">coords</span><span class="o">=</span><span class="n">targets_coords</span><span class="p">,</span> <span class="n">frame_x</span><span class="o">=</span><span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_x</span><span class="p">,</span> <span class="n">frame_y</span><span class="o">=</span><span class="n">trialobj</span><span class="o">.</span><span class="n">imparams</span><span class="o">.</span><span class="n">frame_y</span><span class="p">,</span>
                         <span class="n">edgecolors</span><span class="o">=</span><span class="n">edgecolors</span><span class="p">,</span>
                         <span class="n">background</span><span class="o">=</span><span class="n">background</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">labelcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

    <span class="n">ax</span> <span class="o">=</span> <span class="n">_add_scalebar</span><span class="p">(</span><span class="n">trialobj</span><span class="o">=</span><span class="n">trialobj</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>

    <span class="c1"># fig.tight_layout()</span>

    <span class="k">if</span> <span class="s1">&#39;title&#39;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">kwargs</span><span class="p">[</span><span class="s1">&#39;title&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;SLM targets location - </span><span class="si">{</span><span class="n">trialobj</span><span class="o">.</span><span class="n">t_series_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>

    <span class="c1"># mpl.pyplot.rcdefaults()</span>
    <span class="c1"># fig.show()</span>


<span class="c1"># alloptical trial</span>


<div class="viewcode-block" id="plot_s2pMasks"><a class="viewcode-back" href="../../../making-plots.html#packerlabimaging.plotting.plotting.plot_s2pMasks">[docs]</a><span class="k">def</span> <span class="nf">plot_s2pMasks</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot; Creates some images of SLM targets to suite2p.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span></div>
</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../../index.html">packerlabimaging 0.1-alpha documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../../index.html" >Module code</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">packerlabimaging.plotting.plotting</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2022, Packer Lab.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 4.4.0.
    </div>
  </body>
</html>